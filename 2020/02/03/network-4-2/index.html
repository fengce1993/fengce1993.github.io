<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>计算机网络(五)：网络层(二) | BLEACH</title><meta name="description" content="计算机网络(五)：网络层(二)"><meta name="keywords" content="计算机网络"><meta name="author" content="fc"><meta name="copyright" content="fc"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="计算机网络(五)：网络层(二)"><meta name="twitter:description" content="计算机网络(五)：网络层(二)"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="计算机网络(五)：网络层(二)"><meta property="og:url" content="http://fengce1993.github.io/2020/02/03/network-4-2/"><meta property="og:site_name" content="BLEACH"><meta property="og:description" content="计算机网络(五)：网络层(二)"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://fengce1993.github.io/2020/02/03/network-4-2/"><link rel="next" title="计算机网络(四)：网络层(一)" href="http://fengce1993.github.io/2020/02/02/network-4-1/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">BLEACH</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">5</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">1</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">1</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-网际控制报文协议-icmp"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text"> 1 网际控制报文协议 ICMP</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#11-icmp-报文的种类"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text"> 1.1 ICMP 报文的种类</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#12-icmp的应用举例"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text"> 1.2 ICMP的应用举例</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-因特网的路由选择协议"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text"> 2 因特网的路由选择协议</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#21-路由选择协议的基本概念"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text"> 2.1 路由选择协议的基本概念</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#22-内部网关协议-rip"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text"> 2.2 内部网关协议 RIP</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#23-内部网关协议-ospf"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text"> 2.3 内部网关协议 OSPF</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#24-外部网关协议-bgp"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text"> 2.4 外部网关协议 BGP</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#25-路由器在网际互连中的作用"><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text"> 2.5 路由器在网际互连中的作用</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-ip多播"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text"> 3 IP多播</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#31-ip-多播的基本概念"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text"> 3.1 IP 多播的基本概念</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#32-在局域网上进行硬件多播"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text"> 3.2 在局域网上进行硬件多播</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#33-网际组管理协议-igmp-和多播路由选择协议"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text"> 3.3 网际组管理协议 IGMP 和多播路由选择协议</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-虚拟专用网-vpn-和网络地址转换-nat"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text"> 4 虚拟专用网 VPN 和网络地址转换 NAT</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#41-虚拟专用网-vpn"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text"> 4.1 虚拟专用网 VPN</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#42-网络地址转换-nat"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text"> 4.2 网络地址转换 NAT</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-网际控制报文协议-icmp"><span class="toc-number">1.</span> <span class="toc-text"> 1 网际控制报文协议 ICMP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-icmp-报文的种类"><span class="toc-number">1.1.</span> <span class="toc-text"> 1.1 ICMP 报文的种类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-icmp的应用举例"><span class="toc-number">1.2.</span> <span class="toc-text"> 1.2 ICMP的应用举例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-因特网的路由选择协议"><span class="toc-number">2.</span> <span class="toc-text"> 2 因特网的路由选择协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-路由选择协议的基本概念"><span class="toc-number">2.1.</span> <span class="toc-text"> 2.1 路由选择协议的基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-内部网关协议-rip"><span class="toc-number">2.2.</span> <span class="toc-text"> 2.2 内部网关协议 RIP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-内部网关协议-ospf"><span class="toc-number">2.3.</span> <span class="toc-text"> 2.3 内部网关协议 OSPF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-外部网关协议-bgp"><span class="toc-number">2.4.</span> <span class="toc-text"> 2.4 外部网关协议 BGP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-路由器在网际互连中的作用"><span class="toc-number">2.5.</span> <span class="toc-text"> 2.5 路由器在网际互连中的作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-ip多播"><span class="toc-number">3.</span> <span class="toc-text"> 3 IP多播</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-ip-多播的基本概念"><span class="toc-number">3.1.</span> <span class="toc-text"> 3.1 IP 多播的基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-在局域网上进行硬件多播"><span class="toc-number">3.2.</span> <span class="toc-text"> 3.2 在局域网上进行硬件多播</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-网际组管理协议-igmp-和多播路由选择协议"><span class="toc-number">3.3.</span> <span class="toc-text"> 3.3 网际组管理协议 IGMP 和多播路由选择协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-虚拟专用网-vpn-和网络地址转换-nat"><span class="toc-number">4.</span> <span class="toc-text"> 4 虚拟专用网 VPN 和网络地址转换 NAT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-虚拟专用网-vpn"><span class="toc-number">4.1.</span> <span class="toc-text"> 4.1 虚拟专用网 VPN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-网络地址转换-nat"><span class="toc-number">4.2.</span> <span class="toc-text"> 4.2 网络地址转换 NAT</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">计算机网络(五)：网络层(二)</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-02-03<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-02-03</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2020/02/03/network-4-2/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h2 id="1-网际控制报文协议-icmp"><a class="markdownIt-Anchor" href="#1-网际控制报文协议-icmp"></a> 1 网际控制报文协议 ICMP</h2>
<p>为了提高 IP 数据报交付成功的机会，在网际层使用了网际控制报文协议 ICMP (Internet Control Message Protocol)。ICMP 允许主机或路由器报告差错情况和提供有关异常情况的报告。ICMP 不是高层协议，而是 IP 层的协议。ICMP 报文作为 IP 层数据报的数据，加上数据报的首部，组成 IP 数据报发送出去。</p>
<p><a href="/pic/network/4-24.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-24.png" class="lazyload"></a></p>
<h3 id="11-icmp-报文的种类"><a class="markdownIt-Anchor" href="#11-icmp-报文的种类"></a> 1.1 ICMP 报文的种类</h3>
<p>ICMP 报文的种类有两种，即 <strong>ICMP 差错报告报文</strong>和 <strong>ICMP 询问报文</strong>。</p>
<p>ICMP 报文的前 4 个字节是统一的格式，共有三个字段：即<strong>类型</strong>、<strong>代码</strong>和<strong>检验和</strong>。接着的 4 个字节的内容与 ICMP 的类型有关。</p>
<p><strong>ICMP 差错报告报文种类</strong>：</p>
<ol>
<li>终点不可达</li>
<li>源点抑制</li>
<li>时间超过</li>
<li>参数问题</li>
<li>改变路由（重定向）</li>
</ol>
<p><strong>ICMP 差错报告报文的数据字段的内容</strong></p>
<p><a href="/pic/network/4-25.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-25.png" class="lazyload"></a></p>
<p>不应发送 ICMP 差错报告报文的几种情况：</p>
<ol>
<li>对 ICMP 差错报告报文不再发送 ICMP 差错报告报文。</li>
<li>对第一个分片的数据报片的所有后续数据报片都不发送 ICMP 差错报告报文。</li>
<li>对具有多播地址的数据报都不发送 ICMP 差错报告报文。</li>
<li>对具有特殊地址（如127.0.0.0 或 0.0.0.0）的数据报不发送 ICMP 差错报告报文。</li>
</ol>
<hr>
<p><strong>ICMP 询问报文种类</strong></p>
<ol>
<li>回送请求和回答报文</li>
<li>时间戳请求和回答报文</li>
</ol>
<h3 id="12-icmp的应用举例"><a class="markdownIt-Anchor" href="#12-icmp的应用举例"></a> 1.2 ICMP的应用举例</h3>
<p><strong>PING 命令</strong></p>
<ul>
<li>PING 用来测试两个主机之间的连通性。</li>
<li>PING 使用了 <strong>ICMP 回送请求与回送回答报文</strong>。</li>
<li>PING 是<strong>应用层直接使用网络层 ICMP</strong> 的例子，它没有通过运输层的 TCP 或UDP。</li>
</ul>
<p><strong>Traceroute 命令</strong></p>
<ul>
<li>traceroute 命令利用ICMP 协议定位您的计算机和目标计算机之间的所有路由器。</li>
<li>TTL 值可以反映数据包经过的路由器或网关的数量，通过操纵独立ICMP 呼叫报文的TTL 值和观察该报文被抛弃的返回信息，traceroute命令能够遍历到数据包传输路径上的所有路由器。</li>
<li>基于 UDP 实现和基于 ICMP 实现。</li>
</ul>
<h2 id="2-因特网的路由选择协议"><a class="markdownIt-Anchor" href="#2-因特网的路由选择协议"></a> 2 因特网的路由选择协议</h2>
<h3 id="21-路由选择协议的基本概念"><a class="markdownIt-Anchor" href="#21-路由选择协议的基本概念"></a> 2.1 路由选择协议的基本概念</h3>
<p><strong>最佳路由</strong></p>
<p>不存在一种绝对的最佳路由算法。所谓“最佳”只能是相对于某一种特定要求下得出的较为合理的选择而已。实际的路由选择算法，应尽可能接近于理想的算法。路由选择是个非常复杂的问题，它是网络中的所有结点共同协调工作的结果。路由选择的环境往往是不断变化的，而这种变化有时无法事先知道。</p>
<hr>
<p>从路由算法的<strong>自适应性</strong>考虑</p>
<ul>
<li><strong>静态路由选择策略</strong>：即非自适应路由选择，其特点是简单和开销较小，但不能及时适应网络状态的变化。</li>
<li><strong>动态路由选择策略</strong>：即自适应路由选择，其特点是能较好地适应网络状态的变化，但实现起来较为复杂，开销也比较大。</li>
</ul>
<hr>
<p><strong>分层次的路由选择协议</strong></p>
<p>因特网采用分层次的路由选择协议。</p>
<p>因特网的规模非常大。如果让所有的路由器知道所有的网络应怎样到达，则这种路由表将非常大，处理起来也太花时间。而所有这些路由器之间交换路由信息所需的带宽就会使因特网的通信链路饱和。</p>
<p>许多单位不愿意外界了解自己单位网络的布局细节和本部门所采用的路由选择协议（这属于本部门内部的事情），但同时还希望连接到因特网上。</p>
<hr>
<p><strong>自治系统 AS</strong> (Autonomous System)</p>
<p>定义：在单一的技术管理下的一组路由器，而这些路由器使用一种 AS 内部的路由选择协议和共同的度量以确定分组在该 AS 内的路由，同时还使用一种 AS 之间的路由选择协议用以确定分组在 AS之间的路由。</p>
<p>现在对自治系统 AS 的定义是强调下面的事实：尽管一个 AS 使用了多种内部路由选择协议和度量，但重要的是一个 AS 对其他 AS 表现出的是一个<strong>单一的</strong>和<strong>一致的路由选择策略</strong>。</p>
<hr>
<p><strong>因特网有两大类路由选择协议</strong></p>
<p><strong>内部网关协议 IGP</strong>：即在一个自治系统内部使用的路由选择协议。目前这类路由选择协议使用得最多，如 <strong>RIP</strong> 和 <strong>OSPF</strong> 协议。</p>
<p><strong>外部网关协议 EGP</strong>：若源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。这样的协议就是外部网关协议 EGP。在外部网关协议中目前使用最多的是 <strong>BGP-4</strong>。</p>
<p><a href="/pic/network/4-26.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-26.png" class="lazyload"></a></p>
<hr>
<h3 id="22-内部网关协议-rip"><a class="markdownIt-Anchor" href="#22-内部网关协议-rip"></a> 2.2 内部网关协议 RIP</h3>
<p><strong>工作原理</strong></p>
<p>路由信息协议 RIP 是内部网关协议 IGP中最先得到广泛使用的协议。</p>
<p>RIP 是一种分布式的基于<strong>距离向量</strong>的路由选择协议。</p>
<p>RIP 协议要求网络中的每一个路由器都要维护<strong>从它自己到其他每一个目的网络的距离记录</strong>。</p>
<hr>
<p>“<strong>距离</strong>”的定义</p>
<ul>
<li>从一路由器到直接连接的网络的距离定义为 1；</li>
<li>从一个路由器到非直接连接的网络的距离定义为所经过的路由器数加 1；</li>
<li>RIP 协议中的“距离”也称为“跳数”(hop count)，因为每经过一个路由器，跳数就加 1；</li>
<li>这里的“距离”实际上指的是“最短距离”；</li>
<li>RIP 认为一个好的路由就是它通过的路由器的数目少，即“距离短”。</li>
<li>RIP 允许一条路径最多只能包含 15 个路由器。</li>
<li>“距离”的最大值为16 时即相当于不可达。可见 RIP 只适用于小型互联网。</li>
<li>RIP 不能在两个网络之间同时使用多条路由。RIP 选择一个具有最少路由器的路由（即最短路由），哪怕还存在另一条高速(低时延)但路由器较多的路由。</li>
</ul>
<hr>
<p><strong>RIP 协议的三个要点</strong></p>
<ol>
<li>仅和相邻路由器交换信息。</li>
<li>交换的信息是当前本路由器所知道的全部信息，即自己的路由表。</li>
<li>按固定的时间间隔交换路由信息，例如，每隔 30 秒。</li>
</ol>
<hr>
<p><strong>路由表的建立</strong></p>
<ol>
<li>路由器在刚刚开始工作时，只知道到直接连接的网络的距离（此距离定义为1）。</li>
<li>以后，每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息。</li>
<li>经过若干次更新后，所有的路由器最终都会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器的地址。</li>
<li>RIP 协议的收敛过程较快，即在自治系统中所有的结点都得到正确的路由选择信息的过程。</li>
</ol>
<p><strong>路由器之间交换信息</strong></p>
<p>RIP协议让互联网中的所有路由器都和自己的相邻路由器不断交换路由信息，并不断更新其路由表，使得从每一个路由器到每一个目的网络的路由都是最短的（即跳数最少）。</p>
<p>虽然所有的路由器最终都拥有了整个自治系统的全局路由信息，但由于每一个路由器的位置不同，它们的路由表当然也应当是不同的。</p>
<hr>
<p><strong>距离向量算法</strong></p>
<p>收到相邻路由器（其地址为 X）的一个 RIP 报文：</p>
<ol>
<li>先修改此 RIP 报文中的所有项目：把“下一跳”字段中的地址都改为 X，并把所有的“距离”字段的值加 1。</li>
<li>对修改后的 RIP 报文中的每一个项目，重复以下步骤：
<ol>
<li>若项目中的目的网络不在路由表中，则把该项目加到路由表中。</li>
<li>否则若下一跳字段给出的路由器地址是同样的，则把收到的项 目 替换原路由表中的项目。</li>
<li>否则若收到项目中的距离小于路由表中的距离，则进行更新，</li>
<li>否则什么也不做。</li>
</ol>
</li>
<li>若 3 分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由器，即将距离置为16（距离为16表示不可达）。</li>
<li>返回。</li>
</ol>
<hr>
<p><strong>RIP2 协议的报文格式</strong></p>
<p><a href="/pic/network/4-27.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-27.png" class="lazyload"></a></p>
<p>RIP2 的报文由首部和路由部分组成。</p>
<ul>
<li>RIP2 报文中的路由部分由若干个路由信息组成。每个路由信息需要用 20 个字节。</li>
<li><strong>地址族标识符</strong>（又称为地址类别）字段用来标志所使用的地址协议。</li>
<li><strong>路由标记</strong>填入自治系统的号码，这是考虑使RIP 有可能收到本自治系统以外的路由选择信息。</li>
<li>再后面指出某个<strong>网络地址</strong>、该网络的<strong>子网掩码</strong>、<strong>下一跳路由器地址</strong>以及<strong>到此网络的距离</strong>。</li>
</ul>
<hr>
<p><strong>RIP 协议的优缺点</strong></p>
<ul>
<li>RIP 存在的一个问题是当网络出现故障时，要经过比较长的时间才能将此信息传送到所有的路由器（     好消息传播得快，而坏消息传播得慢）。</li>
<li>RIP 协议最大的优点就是实现简单，开销较小。</li>
<li>RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。</li>
<li>路由器之间交换的路由信息是路由器中的完整路由表，因而随着网络规模的扩大，开销也就增加。</li>
</ul>
<h3 id="23-内部网关协议-ospf"><a class="markdownIt-Anchor" href="#23-内部网关协议-ospf"></a> 2.3 内部网关协议 OSPF</h3>
<p><strong>OSPF 协议的基本特点</strong></p>
<ul>
<li>“开放”表明 OSPF 协议不是受某一家厂商控制，而是公开发表的；</li>
<li>“最短路径优先”是因为使用了 Dijkstra 提出的最短路径算法SPF；</li>
<li>OSPF 只是一个协议的名字，它并不表示其他的路由选择协议不是“最短路径优先”；</li>
<li>是分布式的链路状态协议；</li>
</ul>
<hr>
<p><strong>三个要点</strong></p>
<ol>
<li>
<p>向本自治系统中<strong>所有路由器</strong>发送信息，这里使用的方法是<strong>洪泛法</strong>。</p>
</li>
<li>
<p>发送的信息就是与本路由器<strong>相邻的所有路由器的链路状态</strong>，但这只是路由器所知道的<strong>部分信息</strong>。</p>
<p>“链路状态”就是说明本路由器都和哪些路由器相邻，以及该链路的“度量”(metric)。</p>
</li>
<li>
<p>只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息。</p>
</li>
</ol>
<hr>
<p><strong>链路状态数据库</strong></p>
<p>由于各路由器之间频繁地交换链路状态信息，因此所有的路由器最终都能建立一个链路状态数据库。</p>
<p>这个数据库实际上就是<strong>全网的拓扑结构图</strong>，它在全网范围内是一致的（这称为链路状态数据库的同步）。</p>
<p>OSPF 的链路状态数据库能较快地进行更新，使各个路由器能及时更新其路由表。OSPF 的更新过程收敛得快是其重要优点。</p>
<hr>
<p><strong>OSPF 的区域</strong></p>
<p>为了使 OSPF 能够用于规模很大的网络，OSPF 将一个自治系统再划分为若干个更小的范围，叫作<strong>区域</strong>。每一个区域都有一个 32 位的区域标识符（用点分十进制表示）。区域也不能太大，在一个区域内的路由器最好不超过 200 个。</p>
<p>OSPF 划分为两种不同的区域</p>
<p><a href="/pic/network/4-28.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-28.png" class="lazyload"></a></p>
<p>划分区域的好处就是将利用洪泛法交换链路状态信息的范围局限于每一个区域而不是整个的自治系统，这就减少了整个网络上的通信量。</p>
<p>在一个区域内部的路由器只知道本区域的完整网络拓扑，而不知道其他区域的网络拓扑的情况。</p>
<p>OSPF 使用层次结构的区域划分。在上层的区域叫作<strong>主干区域</strong>。主干区域的标识符规定为0.0.0.0。主干区域的作用是用来连通其他在下层的区域。</p>
<hr>
<p><strong>OSPF 直接用 IP 数据报传送</strong></p>
<p>OSPF 不用 UDP 而是直接用 IP 数据报传送。</p>
<p>OSPF 构成的数据报很短。这样做可减少路由信息的通信量。</p>
<p>数据报很短的另一好处是可以不必将长的数据报分片传送。分片传送的数据报只要丢失一个，就无法组装成原来的数据报，而整个数据报就必须重传。</p>
<hr>
<p><strong>OSPF 的其他特点</strong></p>
<ul>
<li>OSPF 对不同的链路可根据 IP 分组的不同服务类型 TOS 而设置成不同的代价。因此，OSPF 对于不同类型的业务可计算出不同的路由。</li>
<li>如果到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径。这叫作<strong>多路径间的负载平衡</strong>。</li>
<li>所有在 OSPF 路由器之间交换的分组都具有鉴别的功能。</li>
<li>支持可变长度的子网划分和无分类编址 CIDR。</li>
<li>每一个链路状态都带上一个 32 位的序号，序号越大状态就越新。</li>
</ul>
<p><a href="/pic/network/4-29.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-29.png" class="lazyload"></a></p>
<hr>
<p><strong>OSPF 的分组类型</strong></p>
<ol>
<li>问候(Hello)分组。</li>
<li>数据库描述(Database Description)分组。</li>
<li>链路状态请求(Link State Request)分组。</li>
<li>链路状态更新(Link State Update)分组，用洪泛法对全网更新链路状态。</li>
<li>链路状态确认(Link State Acknowledgment)分组。</li>
</ol>
<p><a href="/pic/network/4-30.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-30.png" class="lazyload"></a></p>
<hr>
<p><strong>OSPF 的其他特点</strong></p>
<ul>
<li>OSPF 还规定每隔一段时间，如 30 分钟，要刷新一次数据库中的链路状态。</li>
<li>由于一个路由器的链路状态只涉及到与相邻路由器的连通状态，因而与整个互联网的规模并无直接关系。因此当互联网规模很大时，OSPF 协议要比距离向量协议 RIP 好得多。</li>
<li>OSPF 没有“坏消息传播得慢”的问题，据统计，其响应网络变化的时间小于 100 ms。</li>
</ul>
<h3 id="24-外部网关协议-bgp"><a class="markdownIt-Anchor" href="#24-外部网关协议-bgp"></a> 2.4 外部网关协议 BGP</h3>
<p>BGP 是不同自治系统的路由器之间交换路由信息的协议。</p>
<p><strong>BGP 使用的环境不同</strong></p>
<p>因特网的规模太大，使得自治系统之间路由选择非常困难。对于自治系统之间的路由选择，要寻找最佳路由是很不现实的。当一条路径通过几个不同 AS 时，要想对这样的路径计算出有意义的代价是不太可能的。比较合理的做法是在 AS 之间交换“可达性”信息。</p>
<p>自治系统之间的路由选择必须考虑有关策略。因此，边界网关协议 BGP 只能是力求寻找一条能够到达目的网络且<strong>比较好的路由</strong>（不能兜圈子），而<strong>并非要寻找一条最佳路由</strong>。</p>
<hr>
<p><strong>BGP 发言人</strong></p>
<p>每一个自治系统的管理员要选择至少一个路由器作为该自治系统的“ BGP 发言人” 。</p>
<p>一般说来，两个 BGP 发言人都是通过一个共享网络连接在一起的，而 BGP 发言人往往就是 BGP 边界路由器，但也可以不是 BGP 边界路由器。</p>
<hr>
<p><strong>BGP 交换路由信息</strong></p>
<p>一个 BGP 发言人与其他自治系统中的 BGP 发言人要交换路由信息，就要先建立 TCP 连接，然后在此连接上交换 BGP 报文以建立 BGP 会话(session)，利用 BGP 会话交换路由信息。</p>
<p>使用 TCP 连接能提供可靠的服务，也简化了路由选择协议。</p>
<p>使用 TCP 连接交换路由信息的两个 BGP 发言人，彼此成为对方的邻站或对等站。</p>
<hr>
<p><a href="/pic/network/4-31.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-31.png" class="lazyload"></a></p>
<p>BGP 所交换的网络可达性的信息就是要到达某个网络所要经过的一系列 AS。</p>
<p>当 BGP 发言人互相交换了网络可达性的信息后，各 BGP 发言人就根据所采用的策略从收到的路由信息中找出到达各 AS 的较好路由。</p>
<hr>
<p><strong>BGP 发言人交换路径向量</strong></p>
<p><a href="/pic/network/4-32.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-32.png" class="lazyload"></a></p>
<p>自治系统 AS<sub>2</sub> 的 BGP 发言人通知主干网的 BGP 发言人：“要到达网络 N<sub>1</sub>, N<sub>2</sub>, N<sub>3</sub> 和 N<sub>4</sub> 可经过 AS<sub>2</sub>”；</p>
<p>主干网还可发出通知：“要到达网络 N<sub>5</sub>, N<sub>6</sub> 和 N<sub>7</sub> 可沿路径（AS<sub>1</sub>,AS<sub>3</sub>）” ；</p>
<hr>
<p><strong>BGP 协议的特点</strong></p>
<ul>
<li>BGP 协议交换路由信息的结点数量级是自治系统数的量级，这要比这些自治系统中的网络数少很多。</li>
<li>每一个自治系统中 BGP 发言人（或边界路由器）的数目是很少的。这样就使得自治系统之间的路由选择不致过分复杂。</li>
<li>BGP 支持 CIDR，因此 BGP 的路由表也就应当包括目的网络前缀、下一跳路由器，以及到达该目的网络所要经过的各个自治系统序列。</li>
<li>在BGP 刚刚运行时，BGP 的邻站是交换整个的 BGP 路由表。但以后只需要在发生变化时更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销方面都有好处。</li>
</ul>
<hr>
<p><strong>BGP-4 报文种类</strong></p>
<ol>
<li>打开(OPEN)报文：用来与相邻的另一个BGP发言人建立关系。</li>
<li>更新(UPDATE)报文：用来发送某一路由的信息，以及列出要撤消的多条路由。</li>
<li>保活(KEEPALIVE)报文：用来确认打开报文和周期性地证实邻站关系。</li>
<li>通知(NOTIFICATION)报文：用来发送检测到的差错。</li>
</ol>
<p><strong>BGP 报文具有通用的首部</strong></p>
<p><a href="/pic/network/4-33.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-33.png" class="lazyload"></a></p>
<h3 id="25-路由器在网际互连中的作用"><a class="markdownIt-Anchor" href="#25-路由器在网际互连中的作用"></a> 2.5 路由器在网际互连中的作用</h3>
<p><strong>路由器的结构</strong></p>
<p>路由器是一种具有多个输入端口和多个输出端口的专用计算机，其任务是<strong>转发分组</strong>。也就是说，将路由器某个输入端口收到的分组，按照分组要去的目的地（即目的网络），把该分组从路由器的某个合适的输出端口转发给下一跳路由器。下一跳路由器也按照这种方法处理分组，直到该分组到达终点为止。</p>
<p><a href="/pic/network/4-34.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-34.png" class="lazyload"></a></p>
<hr>
<p><strong>“转发”和“路由选择”的区别</strong></p>
<ul>
<li>
<p>“转发”(forwarding)就是路由器根据转发表将用户的 IP 数据报从合适的端口转发出去。</p>
</li>
<li>
<p>“路由选择”(routing)则是按照分布式算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由。</p>
</li>
<li>
<p>路由表是根据路由选择算法得出的。而转发表是从路由表得出的。</p>
</li>
<li>
<p>在讨论路由选择的原理时，往往不去区分转发表和路由表的区别。</p>
</li>
</ul>
<hr>
<p>输入端口对线路上收到的分组的处理：</p>
<p>数据链路层剥去帧首部和尾部后，将分组送到网络层的队列中排队等待处理。这会产生一定的时延。</p>
<p><a href="/pic/network/4-35.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-35.png" class="lazyload"></a></p>
<p>输出端口将交换结构传送来的分组发送到线路：</p>
<p>当交换结构传送过来的分组先进行缓存。数据链路层处理模块将分组加上链路层的首部和尾部，交给物理层后发送到外部线路。</p>
<p><a href="/pic/network/4-36.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-36.png" class="lazyload"></a></p>
<hr>
<p><strong>分组丢弃</strong></p>
<p>若路由器处理分组的速率赶不上分组进入队列的速率，则队列的存储空间最终必定减少到零，这就使后面再进入队列的分组由于没有存储空间而只能被丢弃。</p>
<p>路由器中的输入或输出队列产生溢出是造成分组丢失的重要原因。</p>
<h2 id="3-ip多播"><a class="markdownIt-Anchor" href="#3-ip多播"></a> 3 IP多播</h2>
<h3 id="31-ip-多播的基本概念"><a class="markdownIt-Anchor" href="#31-ip-多播的基本概念"></a> 3.1 IP 多播的基本概念</h3>
<p><a href="/pic/network/4-37.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-37.png" class="lazyload"></a></p>
<p>多播可明显地减少网络中资源的消耗</p>
<hr>
<p><strong>IP 多播的特点</strong></p>
<ol>
<li>多播使用组地址：IP 使用 D 类地址支持多播。多播地址只能用于目的地址，而不能用于源地址；</li>
<li>永久组地址：由因特网号码指派管理局 IANA 负责指派；</li>
<li>动态的组成员；</li>
<li>使用硬件进行多播；</li>
</ol>
<h3 id="32-在局域网上进行硬件多播"><a class="markdownIt-Anchor" href="#32-在局域网上进行硬件多播"></a> 3.2 在局域网上进行硬件多播</h3>
<p>因特网号码指派管理局 IANA 拥有的以太网地址块的高 24 位为 00-00-5E。</p>
<p>因此 TCP/IP 协议使用的以太网多播地址块的范围是：从 00-00-5E-00-00-00 到 00-00-5E-FF-FF-FF</p>
<p>D 类 IP 地址可供分配的有 28 位，在这 28 位中的前 5 位不能用来构成以太网硬件地址。</p>
<hr>
<p>D 类 IP 地址与以太网多播地址的映射关系</p>
<p><a href="/pic/network/4-38.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-38.png" class="lazyload"></a></p>
<h3 id="33-网际组管理协议-igmp-和多播路由选择协议"><a class="markdownIt-Anchor" href="#33-网际组管理协议-igmp-和多播路由选择协议"></a> 3.3 网际组管理协议 IGMP 和多播路由选择协议</h3>
<p><strong>IP多播需要两种协议</strong></p>
<ol>
<li>为了使路由器知道多播组成员的信息，需要利用<strong>网际组管理协议 IGMP</strong>。</li>
<li>连接在局域网上的多播路由器还必须和因特网上的其他多播路由器协同工作，以便把多播数据报用最小代价传送给所有的组成员。这就需要使用<strong>多播路由选择协议</strong>。</li>
</ol>
<p><a href="/pic/network/4-39.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-39.png" class="lazyload"></a></p>
<p><strong>IGMP 的本地使用范围</strong></p>
<ul>
<li>IGMP 并非在因特网范围内对所有多播组成员进行管理的协议。</li>
<li>IGMP 不知道 IP 多播组包含的成员数，也不知道这些成员都分布在哪些网络上。</li>
<li>IGMP 协议是让连接在本地局域网上的多播路由器知道本局域网上是否有主机（严格讲，是主机上的某个进程）参加或退出了某个多播组。</li>
</ul>
<p>多播路由选择协议比单播路由选择协议复杂得多：</p>
<ul>
<li>多播转发必须<strong>动态地适应</strong>多播组成员的变化（这时网络拓扑并未发生变化）。请注意，单播路由选择通常是在网络拓扑发生变化时才需要更新路由。</li>
<li>多播路由器在转发多播数据报时，不能仅仅根据多播数据报中的目的地址，而是还要考虑这个多播数据报从什么地方来和要到什么地方去。</li>
<li>多播数据报可以由没有加入多播组的主机发出，也可以通过没有组成员接入的网络。</li>
</ul>
<hr>
<p>IGMP 是整个网际协议 IP 的一个组成部分和 ICMP 相似，IGMP 使用 IP 数据报传递其报文（即 IGMP 报文加上 IP 首部构成 IP 数据报），但它也向 IP 提供服务。因此，我们不把 IGMP 看成是一个单独的协议，而是属于整个网际协议 IP 的一个组成部分。</p>
<p><strong>IGMP 可分为两个阶段</strong></p>
<ul>
<li>第一阶段：当某个主机加入新的多播组时，该主机应向多播组的多播地址发送IGMP 报文，声明自己要成为该组的成员。本地的多播路由器收到 IGMP 报文后，将组成员关系转发给因特网上的其他多播路由器。</li>
<li>第二阶段：因为组成员关系是动态的，因此本地多播路由器要周期性地探询本地局域网上的主机，以便知道这些主机是否还继续是组的成员。只要对某个组有一个主机响应，那么多播路由器就认为这个组是活跃的。但一个组在经过几次的探询后仍然没有一个主机响应，则不再将该组的成员关系转发给其他的多播路由器。</li>
</ul>
<hr>
<p><strong>IGMP 采用的一些具体措施</strong></p>
<ul>
<li>在主机和多播路由器之间的所有通信都是使用 IP 多播。</li>
<li>多播路由器在探询组成员关系时，只需要对所有的组发送一个请求信息的询问报文，而不需要对每一个组发送一个询问报文。默认的询问速率是每 125 秒发送一次。</li>
<li>当同一个网络上连接有几个多播路由器时，它们能够迅速和有效地选择其中的一个来探询主机的成员关系。</li>
<li>在 IGMP 的询问报文中有一个数值 <em>N</em>，它指明一个最长响应时间（默认值为 10秒）。当收到询问时，主机在 0 到 <em>N</em> 之间随机选择发送响应所需经过的时延。对应于最小时延的响应最先发送。</li>
<li>同一个组内的每一个主机都要监听响应，只要有本组的其他主机先发送了响应，自己就可以不再发送响应了。</li>
</ul>
<hr>
<p><strong>多播路由选择</strong></p>
<ul>
<li>多播路由选择协议尚未标准化。</li>
<li>一个多播组中的成员是动态变化的，随时会有主机加入或离开这个多播组。</li>
<li>多播路由选择实际上就是要找出以源主机为根结点的<strong>多播转发树</strong>。</li>
<li>在多播转发树上的路由器不会收到重复的多播数据报。</li>
<li>对不同的多播组对应于不同的多播转发树。同一个多播组，对不同的源点也会有不同的多播转发树。</li>
</ul>
<hr>
<p><strong>转发多播数据报使用的方法</strong></p>
<p>（一）洪泛与剪除</p>
<p>这种方法适合于较小的多播组，而所有的组成员接入的局域网也是相邻接的。</p>
<p>一开始，路由器转发多播数据报使用洪泛的方法（这就是广播）。为了避免兜圈子，采用了叫做反向路径广播 RPB (Reverse Path Broadcasting)的策略。</p>
<p><strong>RPB 的要点</strong></p>
<ol>
<li>路由器收到多播数据报时，先检查是否从源点经最短路径传送来的。</li>
<li>若是，就向所有其他方向转发刚才收到的多播数据报（但进入的方向除外），否则就丢弃而不转发。</li>
<li>如果存在几条同样长度的最短路径，那么只能选择一条最短路径，选择的准则就是看这几条最短路径中的相邻路由器谁的 IP 地址最小。</li>
</ol>
<p><a href="/pic/network/4-40.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-40.png" class="lazyload"></a></p>
<p>（二）隧道技术</p>
<p><a href="/pic/network/4-41.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-41.png" class="lazyload"></a></p>
<p>（三）基于核心的发现技术</p>
<p>这种方法对于多播组的大小在较大范围内变化时都适合。</p>
<p>这种方法是对每一个多播组 G 指定一个核心(core)路由器，给出它的 IP 单播地址。</p>
<p>核心路由器按照前面讲过的方法创建出对应于多播组 G 的转发树。</p>
<h2 id="4-虚拟专用网-vpn-和网络地址转换-nat"><a class="markdownIt-Anchor" href="#4-虚拟专用网-vpn-和网络地址转换-nat"></a> 4 虚拟专用网 VPN 和网络地址转换 NAT</h2>
<h3 id="41-虚拟专用网-vpn"><a class="markdownIt-Anchor" href="#41-虚拟专用网-vpn"></a> 4.1 虚拟专用网 VPN</h3>
<ul>
<li>本地地址：仅在机构内部使用的 IP 地址，可以由本机构自行分配，而不需要向因特网的管理机构申请。</li>
<li>全球地址：全球唯一的IP地址，必须向因特网的管理机构申请。</li>
</ul>
<p>RFC 1918 指明的专用地址：</p>
<ul>
<li>10.0.0.0 到 10.255.255.255</li>
<li>172.16.0.0 到 172.31.255.255</li>
<li>192.168.0.0 到 192.168.255.255</li>
</ul>
<p>这些地址只能用于一个机构的内部通信，而不能用于和因特网上的主机通信。专用地址只能用作本地地址而不能用作全球地址。在因特网中的所有路由器对目的地址是专用地址的数据报一律不进行转发。</p>
<p>用隧道技术可以实现虚拟专用网</p>
<p><a href="/pic/network/4-42.png" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="/pic/network/4-42.png" class="lazyload"></a></p>
<hr>
<p><strong>内联网和外联网</strong></p>
<p>内联网和外联网都是基于 TCP/IP 协议。</p>
<ul>
<li>由部门 A 和 B 的内部网络所构成的虚拟专用网 VPN 又称为内联网(intranet)，表示部门 A 和 B 都是在同一个机构的内部。</li>
<li>一个机构和某些外部机构共同建立的虚拟专用网 VPN 又称为外联网(extranet)。</li>
</ul>
<hr>
<p><strong>远程接入VPN</strong></p>
<p>有的公司可能没有分布在不同场所的部门，但有很多流动员工在外地工作。公司需要和他们保持联系，远程接入 VPN 可满足这种需求。</p>
<p>在外地工作的员工拨号接入因特网，而驻留在员工 PC 机中的 VPN 软件可在员工的 PC 机和公司的主机之间建立 VPN 隧道，因而外地员工与公司通信的内容是保密的，员工们感到好像就是使用公司内部的本地网络。</p>
<h3 id="42-网络地址转换-nat"><a class="markdownIt-Anchor" href="#42-网络地址转换-nat"></a> 4.2 网络地址转换 NAT</h3>
<p>网络地址转换 NAT 方法于1994年提出。</p>
<p>需要在专用网连接到因特网的路由器上安装 NAT 软件。装有 NAT 软件的路由器叫做 NAT路由器，它至少有一个有效的外部全球地址 IP<sub><em>G</em></sub>。</p>
<p>所有使用本地地址的主机在和外界通信时都要在 NAT 路由器上将其本地地址转换成 IP<sub><em>G</em></sub> 才能和因特网连接。</p>
<hr>
<p><strong>网络地址转换的过程</strong></p>
<ol>
<li>内部主机 X 用本地地址 IP<sub><em>x</em></sub> 和因特网上主机 Y 通信所发送的数据报必须经过 NAT 路由器。</li>
<li>NAT 路由器将数据报的源地址 IP<sub><em>x</em></sub> 转换成全球地址 IP<sub><em>G</em></sub>，但目的地址 IP<sub><em>Y</em></sub> 保持不变，然后发送到因特网。</li>
<li>NAT 路由器收到主机 Y 发回的数据报时，知道数据报中的源地址是 IP<sub><em>Y</em></sub> 而目的地址是 IP<sub><em>G</em></sub>。</li>
<li>根据 NAT 转换表，NAT 路由器将目的地址 IP<sub><em>G</em></sub> 转换为 IP<sub><em>x</em></sub>，转发给最终的内部主机 X。</li>
</ol>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">fc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://fengce1993.github.io/2020/02/03/network-4-2/">http://fengce1993.github.io/2020/02/03/network-4-2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://fengce1993.github.io">BLEACH</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2020/02/02/network-4-1/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>计算机网络(四)：网络层(一)</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/01/21/network-1/" title="计算机网络(一)：计算机网络概述"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-21</div><div class="relatedPosts_title">计算机网络(一)：计算机网络概述</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/28/network-2/" title="计算机网络(二)：物理层"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-28</div><div class="relatedPosts_title">计算机网络(二)：物理层</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/30/network-3/" title="计算机网络(三)：数据链路层"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-30</div><div class="relatedPosts_title">计算机网络(三)：数据链路层</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/02/network-4-1/" title="计算机网络(四)：网络层(一)"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-02</div><div class="relatedPosts_title">计算机网络(四)：网络层(一)</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '98c8aa074b828fc6bd11',
  clientSecret: 'e0e862ca02f30148e7b5f049bd5a736d7831a717',
  repo: 'fengce1993.github.io',
  owner: 'fengce1993',
  admin: 'fengce1993',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
}</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By fc</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>