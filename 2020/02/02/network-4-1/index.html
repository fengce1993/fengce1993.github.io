<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>计算机网络(四)：网络层(一) | BLEACH</title><meta name="description" content="计算机网络(四)：网络层(一)"><meta name="keywords" content="计算机网络"><meta name="author" content="fc"><meta name="copyright" content="fc"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="计算机网络(四)：网络层(一)"><meta name="twitter:description" content="计算机网络(四)：网络层(一)"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="计算机网络(四)：网络层(一)"><meta property="og:url" content="http://fengce1993.github.io/2020/02/02/network-4-1/"><meta property="og:site_name" content="BLEACH"><meta property="og:description" content="计算机网络(四)：网络层(一)"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://fengce1993.github.io/2020/02/02/network-4-1/"><link rel="prev" title="计算机网络(五)：网络层(二)" href="http://fengce1993.github.io/2020/02/03/network-4-2/"><link rel="next" title="计算机网络(三)：数据链路层" href="http://fengce1993.github.io/2020/01/30/network-3/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">BLEACH</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">7</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">1</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">1</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-网络层提供的两种服务"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text"> 1 网络层提供的两种服务</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-网际协议ip"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text"> 2 网际协议IP</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#21-虚拟互连网络"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text"> 2.1 虚拟互连网络</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#22-分类的-ip-地址"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text"> 2.2 分类的 IP 地址</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#221-ip-地址及其表示方法"><span class="toc_mobile_items-number">2.2.1.</span> <span class="toc_mobile_items-text"> 2.2.1 IP 地址及其表示方法</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#222-常用的三种类别的-ip-地址"><span class="toc_mobile_items-number">2.2.2.</span> <span class="toc_mobile_items-text"> 2.2.2 常用的三种类别的 IP 地址</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#23-ip-地址与硬件地址"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text"> 2.3 IP 地址与硬件地址</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#24-地址解析协议-arp-和逆地址解析协议-rarp"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text"> 2.4 地址解析协议 ARP 和逆地址解析协议 RARP</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#25-ip-数据报的格式"><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text"> 2.5 IP 数据报的格式</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#26-ip-层转发分组的流程"><span class="toc_mobile_items-number">2.6.</span> <span class="toc_mobile_items-text"> 2.6 IP 层转发分组的流程</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-划分子网和构造超网"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text"> 3 划分子网和构造超网</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#31-划分子网"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text"> 3.1 划分子网</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#32-使用子网掩码的分组转发过程"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text"> 3.2 使用子网掩码的分组转发过程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#33-无分类编址-cidr"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text"> 3.3 无分类编址 CIDR</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-网络层提供的两种服务"><span class="toc-number">1.</span> <span class="toc-text"> 1 网络层提供的两种服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-网际协议ip"><span class="toc-number">2.</span> <span class="toc-text"> 2 网际协议IP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-虚拟互连网络"><span class="toc-number">2.1.</span> <span class="toc-text"> 2.1 虚拟互连网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-分类的-ip-地址"><span class="toc-number">2.2.</span> <span class="toc-text"> 2.2 分类的 IP 地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#221-ip-地址及其表示方法"><span class="toc-number">2.2.1.</span> <span class="toc-text"> 2.2.1 IP 地址及其表示方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#222-常用的三种类别的-ip-地址"><span class="toc-number">2.2.2.</span> <span class="toc-text"> 2.2.2 常用的三种类别的 IP 地址</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-ip-地址与硬件地址"><span class="toc-number">2.3.</span> <span class="toc-text"> 2.3 IP 地址与硬件地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-地址解析协议-arp-和逆地址解析协议-rarp"><span class="toc-number">2.4.</span> <span class="toc-text"> 2.4 地址解析协议 ARP 和逆地址解析协议 RARP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-ip-数据报的格式"><span class="toc-number">2.5.</span> <span class="toc-text"> 2.5 IP 数据报的格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#26-ip-层转发分组的流程"><span class="toc-number">2.6.</span> <span class="toc-text"> 2.6 IP 层转发分组的流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-划分子网和构造超网"><span class="toc-number">3.</span> <span class="toc-text"> 3 划分子网和构造超网</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-划分子网"><span class="toc-number">3.1.</span> <span class="toc-text"> 3.1 划分子网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-使用子网掩码的分组转发过程"><span class="toc-number">3.2.</span> <span class="toc-text"> 3.2 使用子网掩码的分组转发过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-无分类编址-cidr"><span class="toc-number">3.3.</span> <span class="toc-text"> 3.3 无分类编址 CIDR</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">计算机网络(四)：网络层(一)</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-02-02<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-02-02</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2020/02/02/network-4-1/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h2 id="1-网络层提供的两种服务"><a class="markdownIt-Anchor" href="#1-网络层提供的两种服务"></a> 1 网络层提供的两种服务</h2>
<p>在计算机网络领域，网络层应该向运输层提供怎样的服务（“面向连接”还是“无连接”）曾引起了长期的争论。</p>
<p>争论焦点的实质就是：在计算机通信中，<strong>可靠交付应当由谁来负责</strong>？是<strong>网络</strong>还是<strong>端系统</strong>？</p>
<p><strong>电信网的成功经验让网络负责可靠交付</strong>：<strong>面向连接</strong>的通信方式；建立虚电路(Virtual Circuit)，以保证双方通信所需的一切网络资源；如果再使用可靠传输的网络协议，就可使所发送的分组无差错按序到达终点。</p>
<p><a href="/pic/network/4-1.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-1.png" class="lazyload" title></a></p>
<p><strong>虚电路是逻辑连接</strong>：虚电路表示这只是一条逻辑上的连接，分组都沿着这条逻辑连接按照存储转发方式传送，而并不是真正建立了一条物理连接。请注意，电路交换的电话通信是先建立了一条真正的连接。因此分组交换的虚连接和电路交换的连接只是类似，但并不完全一样。</p>
<p><strong>因特网采用的设计思路</strong>：网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。</p>
<p>网络在发送分组时不需要先建立连接。每一个分组（即 IP 数据报）独立发送，与其前后的分组无关（不进行编号）。网络层不提供服务质量的承诺。即所传送的分组可能出错、丢失、重复和失序（不按序到达终点），当然也不保证分组传送的时限。</p>
<p><strong>尽最大努力交付的好处</strong></p>
<ul>
<li>由于传输网络不提供端到端的可靠传输服务，这就使网络中的路由器可以做得比较简单，而且价格低廉（与电信网的交换机相比较）。</li>
<li>如果主机（即端系统）中的进程之间的通信需要是可靠的，那么就由网络的主机中的运输层负责（包括差错处理、流量控制等）。</li>
<li>采用这种设计思路的好处是：<strong>网络的造价大大降低，运行方式灵活，能够适应多种应用</strong>。</li>
<li>因特网能够发展到今日的规模，充分证明了当初采用这种设计思路的正确性。</li>
</ul>
<p><a href="/pic/network/4-2.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-2.png" class="lazyload" title></a></p>
<p><strong>虚电路服务</strong>与<strong>数据报服务</strong>的对比</p>
<table>
<thead>
<tr>
<th style="text-align:center">对比的方面</th>
<th style="text-align:center">虚电路服务</th>
<th style="text-align:center">数据报服务</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">思路</td>
<td style="text-align:center">可靠通信应当由网络来保证</td>
<td style="text-align:center">可靠通信应当由用户主机来保证</td>
</tr>
<tr>
<td style="text-align:center">连接的建立</td>
<td style="text-align:center">必须有</td>
<td style="text-align:center">不需要</td>
</tr>
<tr>
<td style="text-align:center">终点地址</td>
<td style="text-align:center">仅在连接建立阶段使用，每个分组使用短的虚电路号</td>
<td style="text-align:center">每个分组都有终点的完整地址</td>
</tr>
<tr>
<td style="text-align:center">分组的转发</td>
<td style="text-align:center">属于同一条虚电路的分组均按照同一路由进行转发</td>
<td style="text-align:center">每个分组独立选择路由进行转发</td>
</tr>
<tr>
<td style="text-align:center">当结点出故障时</td>
<td style="text-align:center">所有通过出故障的结点的虚电路均不能工作</td>
<td style="text-align:center">出故障的结点可能会丢失分组，一些路由可能会发生变化</td>
</tr>
<tr>
<td style="text-align:center">分组的顺序</td>
<td style="text-align:center">总是按发送顺序到达终点</td>
<td style="text-align:center">到达终点时不一定按发送顺序</td>
</tr>
<tr>
<td style="text-align:center">端到端的差错处理和流量控制</td>
<td style="text-align:center">可以由网络负责，也可以由用户主机负责</td>
<td style="text-align:center">由用户主机负责</td>
</tr>
</tbody>
</table>
<h2 id="2-网际协议ip"><a class="markdownIt-Anchor" href="#2-网际协议ip"></a> 2 网际协议IP</h2>
<p>网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一。与 IP 协议配套使用的还有四个协议：</p>
<ol>
<li><strong>地址解析协议 ARP</strong>  (Address Resolution Protocol)</li>
<li><strong>逆地址解析协议 RARP</strong>  (Reverse Address Resolution Protocol)</li>
<li><strong>网际控制报文协议 ICMP</strong>  (Internet Control Message Protocol)</li>
<li><strong>网际组管理协议 IGMP</strong>  (Internet Group Management Protocol)</li>
</ol>
<p><a href="/pic/network/4-3.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-3.png" class="lazyload" title></a></p>
<h3 id="21-虚拟互连网络"><a class="markdownIt-Anchor" href="#21-虚拟互连网络"></a> 2.1 虚拟互连网络</h3>
<p>互连在一起的网络要进行通信，会遇到许多问题需要解决，如不同的寻址方案、不同的最大分组长度、不同的网络接入机制、不同的超时控制等。</p>
<p>网络互相连接起来要使用一些<strong>中间设备</strong>，中间设备又称为中间系统或中继(relay)系统。</p>
<ul>
<li>物理层中继系统：<strong>转发器</strong>(repeater)。</li>
<li>数据链路层中继系统：<strong>网桥或桥接器</strong>(bridge)。</li>
<li>网络层中继系统：<strong>路由器</strong>(router)。</li>
<li>网桥和路由器的混合物：<strong>桥路器</strong>(brouter)。</li>
<li>网络层以上的中继系统：<strong>网关</strong>(gateway)。</li>
</ul>
<p><strong>网络互连使用路由器</strong></p>
<p>当中继系统是转发器或网桥时，一般并不称之为网络互连，因为这仅仅是把一个网络扩大了，而这仍然是一个网络；网关由于比较复杂，目前使用得较少；互联网都是指用<strong>路由器</strong>进行互连的网络。由于历史的原因，许多有关 TCP/IP 的文献将网络层使用的路由器称为网关。</p>
<p><strong>虚拟互连网络的意义</strong></p>
<p>所谓虚拟互连网络也就是逻辑互连网络，它的意思就是互连起来的各种物理网络的异构性本来是客观存在的，但是我们利用 IP 协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络。</p>
<p>使用 IP 协议的虚拟互连网络可简称为 IP 网。</p>
<p>使用虚拟互连网络的好处：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互连的各具体的网络异构细节。</p>
<p><a href="/pic/network/4-4.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-4.png" class="lazyload" title></a></p>
<p>从网络层看 IP 数据报的传送：如果我们只从网络层考虑问题，那么 IP 数据报就可以想象是在网络层中传送。</p>
<h3 id="22-分类的-ip-地址"><a class="markdownIt-Anchor" href="#22-分类的-ip-地址"></a> 2.2 分类的 IP 地址</h3>
<h4 id="221-ip-地址及其表示方法"><a class="markdownIt-Anchor" href="#221-ip-地址及其表示方法"></a> 2.2.1 IP 地址及其表示方法</h4>
<p>我们把整个因特网看成为一个单一的、抽象的网络。IP 地址就是给每个连接在因特网上的主机（或路由器）分配一个在全世界范围是唯一的 32 位的标识符。</p>
<p><strong>IP 地址的编址方法</strong></p>
<ul>
<li><strong>分类的 IP 地址</strong>：这是最基本的编址方法，在 1981 年就通过了相应的标准协议。</li>
<li><strong>子网的划分</strong>：这是对最基本的编址方法的改进，其标准[RFC 950]在 1985 年通过。</li>
<li><strong>构成超网</strong>：这是比较新的无分类编址方法。1993 年提出后很快就得到推广应用。</li>
</ul>
<p><strong>分类 IP 地址</strong></p>
<p>每一类地址都由两个固定长度的字段组成，其中一个字段是<strong>网络号</strong> net-id，它标志主机（或路由器）所连接到的网络，而另一个字段则是<strong>主机号</strong> host-id，它标志该主机（或路由器）。两级的 IP 地址可以记为：</p>
<pre class="highlight"><code class>IP 地址 ::= { &lt;网络号&gt;, &lt;主机号&gt;}     （::= 代表“定义为”）
</code></pre>
<p><a href="/pic/network/4-5.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-5.png" class="lazyload" title></a></p>
<p><strong>点分十进制记法</strong></p>
<p><a href="/pic/network/4-6.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-6.png" class="lazyload" title></a></p>
<h4 id="222-常用的三种类别的-ip-地址"><a class="markdownIt-Anchor" href="#222-常用的三种类别的-ip-地址"></a> 2.2.2 常用的三种类别的 IP 地址</h4>
<p>IP 地址的使用范围</p>
<table>
<thead>
<tr>
<th style="text-align:center">网络类别</th>
<th style="text-align:center">最大网络数</th>
<th style="text-align:center">第一个可用的网络号</th>
<th style="text-align:center">最后一个可用的网络号</th>
<th style="text-align:center">每个网络中最大的主机数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A</td>
<td style="text-align:center">126 (2<sup>7</sup> – 2)</td>
<td style="text-align:center">1</td>
<td style="text-align:center">126</td>
<td style="text-align:center">16,777,214</td>
</tr>
<tr>
<td style="text-align:center">B</td>
<td style="text-align:center">16,383(2<sup>14</sup> - 1)</td>
<td style="text-align:center">128.1</td>
<td style="text-align:center">191.255</td>
<td style="text-align:center">65,534</td>
</tr>
<tr>
<td style="text-align:center">C</td>
<td style="text-align:center">2,097,151 (2<sup>21</sup> - 1)</td>
<td style="text-align:center">192.0.1</td>
<td style="text-align:center">223.255.255</td>
<td style="text-align:center">254</td>
</tr>
</tbody>
</table>
<p><strong>IP 地址的重要特点</strong></p>
<ol>
<li>IP 地址是一种分等级的地址结构，分两个等级的好处是：
<ol>
<li>IP 地址管理机构在分配 IP 地址时<strong>只分配网络号</strong>，而剩下的主机号则由得到该网络号的单位自行分配。这样就方便了 IP 地址的管理。</li>
<li>路由器仅根据目的主机所连接的网络号来转发分组（而不考虑目的主机号），这样就可以使路由表中的项目数大幅度减少，从而减小了路由表所占的存储空间。</li>
</ol>
</li>
<li>实际上 IP 地址是标志一个主机（或路由器）和一条链路的接口。
<ol>
<li>当一个主机同时连接到两个网络上时，该主机就必须同时具有两个相应的 IP 地址，其网络号 net-id 必须是不同的。这种主机称为<strong>多归属主机</strong>(multihomed host)。</li>
<li>由于一个路由器至少应当连接到两个网络（这样它才能将 IP 数据报从一个网络转发到另一个网络），因此一个路由器<strong>至少</strong>应当有两个不同的 IP 地址。</li>
</ol>
</li>
<li>用<strong>转发器或网桥</strong>连接起来的若干个局域网仍为一个网络，因此这些局域网都具有同样的网络号 net-id。</li>
<li>所有分配到网络号 net-id 的网络，范围很小的局域网，还是可能覆盖很大地理范围的广域网，都是平等的。</li>
</ol>
<p><a href="/pic/network/4-7.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-7.png" class="lazyload" title></a></p>
<ul>
<li>在同一个局域网上的主机或路由器的 IP 地址中的网络号必须是一样的，图中的网络号就是 IP 地址中的 net-id。</li>
<li>路由器总是具有两个或两个以上的 IP 地址。路由器的每一个接口都有一个不同网络号的 IP 地址。</li>
<li>两个路由器直接相连的接口处，可指明也可不指明 IP 地址。如指明 IP 地址，则这一段连线就构成了一种只包含一段线路的特殊“网络” 。现在常不指明 IP 地址。</li>
</ul>
<h3 id="23-ip-地址与硬件地址"><a class="markdownIt-Anchor" href="#23-ip-地址与硬件地址"></a> 2.3 IP 地址与硬件地址</h3>
<p><a href="/pic/network/4-8.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-8.png" class="lazyload" title></a></p>
<p>从三个不同的层次看数据的流动过程</p>
<p><a href="/pic/network/4-9.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-9.png" class="lazyload" title></a></p>
<p><a href="/pic/network/4-10.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-10.png" class="lazyload" title></a></p>
<p>在 IP 层抽象的互联网上只能看到 IP 数据报图中的 IP1<strong>→</strong>IP2 表示从源地址 IP1 到目的地址 IP2 两个路由器的 IP 地址并不出现在 IP 数据报的首部中。</p>
<p>路由器只根据目的站的 IP 地址的网络号进行路由选择。</p>
<p>IP层抽象的互联网屏蔽了下层很复杂的细节在抽象的网络层上讨论问题，就能够使用统一的、抽象的 IP 地址研究主机和主机或主机和路由器之间的通信。</p>
<p><a href="/pic/network/4-11.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-11.png" class="lazyload" title></a></p>
<p>在具体的物理网络的链路层只能看见 MAC 帧而看不见 IP 数据报。</p>
<h3 id="24-地址解析协议-arp-和逆地址解析协议-rarp"><a class="markdownIt-Anchor" href="#24-地址解析协议-arp-和逆地址解析协议-rarp"></a> 2.4 地址解析协议 ARP 和逆地址解析协议 RARP</h3>
<p><a href="/pic/network/4-12.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-12.png" class="lazyload" title></a></p>
<p>不管网络层使用的是什么协议，在实际网络的链路上传送数据帧时，最终还是必须使用硬件地址。</p>
<p>每一个主机都设有一个 <strong>ARP 高速缓存</strong>(ARP cache)，里面有所在的局域网上的各主机和路由器的 <strong>IP 地址到硬件地址</strong>的映射表。当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时，就先在其 ARP 高速缓存中查看有无主机 B 的 IP 地址。如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，然后通过局域网将该 MAC 帧发往此硬件地址。</p>
<p><a href="/pic/network/4-13.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-13.png" class="lazyload" title></a></p>
<p><strong>ARP 高速缓存的作用</strong>：为了减少网络上的通信量，主机 A 在发送其 ARP 请求分组时，就将自己的 IP 地址到硬件地址的映射写入 ARP 请求分组。当主机 B 收到 A 的 ARP 请求分组时，就将主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了。</p>
<p>ARP 是解决<strong>同一个局域网</strong>上的主机或路由器的 IP 地址和硬件地址的映射问题。如果所要找的主机和源主机不在同一个局域网上，那么就要通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。剩下的工作就由下一个网络来做。</p>
<p>从IP地址到硬件地址的解析是<strong>自动进行</strong>的，主机的用户对这种地址解析过程是不知道的。只要主机或路由器要和本网络上的另一个已知 IP 地址的主机或路由器进行通信，ARP 协议就会自动地将该 IP 地址解析为链路层所需要的硬件地址。</p>
<p><strong>使用 ARP 的四种典型情况</strong></p>
<ol>
<li>发送方是主机，要把IP数据报发送到本网络上的另一个主机。这时用 ARP 找到目的主机的硬件地址。</li>
<li>发送方是主机，要把 IP 数据报发送到另一个网络上的一个主机。这时用 ARP 找到本网络上的一个路由器的硬件地址。剩下的工作由这个路由器来完成。</li>
<li>发送方是路由器，要把 IP 数据报转发到本网络上的一个主机。这时用 ARP 找到目的主机的硬件地址。</li>
<li>发送方是路由器，要把 IP 数据报转发到另一个网络上的一个主机。这时用 ARP 找到本网络上的一个路由器的硬件地址。剩下的工作由这个路由器来完成。</li>
</ol>
<p><strong>什么我们不直接使用硬件地址进行通信？</strong></p>
<p>由于全世界存在着各式各样的网络，它们使用不同的硬件地址。要使这些异构网络能够互相通信就必须进行非常复杂的硬件地址转换工作，因此几乎是不可能的事。</p>
<p>连接到因特网的主机都拥有统一的 IP 地址，它们之间的通信就像连接在同一个网络上那样简单方便，因为调用 ARP 来寻找某个路由器或主机的硬件地址都是由计算机软件自动进行的，对用户来说是看不见这种调用过程的。</p>
<p>逆地址解析协议 RARP 使只知道自己硬件地址的主机能够知道其 IP 地址。这种主机往往是无盘工作站，因此 RARP协议目前已很少使用。</p>
<h3 id="25-ip-数据报的格式"><a class="markdownIt-Anchor" href="#25-ip-数据报的格式"></a> 2.5 IP 数据报的格式</h3>
<p>一个 IP 数据报由<strong>首部</strong>和<strong>数据</strong>两部分组成。首部的前一部分是固定长度，共 20 字节，是所有 IP 数据报必须具有的。在首部的固定部分的后面是一些可选字段，其长度是可变的。</p>
<p><a href="/pic/network/4-14.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-14.png" class="lazyload" title></a></p>
<p><strong>版本</strong>：占 4 位，指 IP 协议的版本。目前的 IP 协议版本号为 4 (即 IPv4)</p>
<p><strong>首部长度</strong>：占 4 位，可表示的最大数值是 15 个单位(一个单位为 4 字节)，因此 IP 的首部长度的最大值是 60 字节。</p>
<p><strong>区分服务</strong>：占 8 位，用来获得更好的服务。在旧标准中叫做服务类型，但实际上一直未被使用过。1998 年这个字段改名为区分服务。只有在使用区分服务时，这个字段才起作用。在一般的情况下都不使用这个字段。</p>
<p><strong>总长度</strong>：占 16 位，指首部和数据之和的长度，单位为字节，因此数据报的最大长度为 65535 字节。总长度必须不超过最大传送单元 MTU。</p>
<p><strong>标识</strong>：占 16 位，它是一个计数器，用来产生数据报的标识。</p>
<p><strong>标志</strong>：占 3 位，目前只有前两位有意义。标志字段的最低位是 <strong>MF</strong> (More Fragment)。MF = 1 表示后面“还有分片”。MF = 0 表示最后一个分片。标志字段中间的一位是 <strong>DF</strong> (Don’t Fragment) 。只有当 DF = 0 时才允许分片。</p>
<p><strong>片偏移</strong>：占12 位，指出较长的分组在分片后某片在原分组中的相对位置。片偏移以 8 个字节为偏移单位。</p>
<p><a href="/pic/network/4-15.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-15.png" class="lazyload" title></a></p>
<p><strong>生存时间</strong>：占8 位，记为 TTL (Time To Live)，数据报在网络中可通过的路由器数的最大值。</p>
<p><strong>协议</strong>：占8 位，字段指出此数据报携带的数据使用何种协议以便目的主机的 IP 层将数据部分上交给哪个处理过程。协议包括TCP、UDP、ICMP、IGMP、OSPF等。</p>
<p><strong>首部检验和</strong>：占16 位，字段只检验数据报的首部不检验数据部分。这里不采用 CRC 检验码而采用简单的计算方法。</p>
<p><a href="/pic/network/4-16.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-16.png" class="lazyload" title></a></p>
<p><strong>源地址和目的地址</strong>：都各占 4 字节</p>
<p><strong>IP 数据报首部的可变部分</strong></p>
<p>IP 首部的可变部分就是一个选项字段，用来支持排错、测量以及安全等措施，内容很丰富。</p>
<p>选项字段的长度可变，从 1 个字节到 40 个字节不等，取决于所选择的项目。</p>
<p>增加首部的可变部分是为了增加 IP 数据报的功能，但这同时也使得 IP 数据报的首部长度成为可变的。这就增加了每一个路由器处理数据报的开销。实际上这些选项很少被使用。</p>
<h3 id="26-ip-层转发分组的流程"><a class="markdownIt-Anchor" href="#26-ip-层转发分组的流程"></a> 2.6 IP 层转发分组的流程</h3>
<p>有四个 A 类网络通过三个路由器连接在一起。每一个网络上都可能有成千上万个主机。可以想像，若按目的主机号来制作路由表，则所得出的路由表就会过于庞大。但若按主机所在的网络地址来制作路由表，那么每一个路由器中的路由表就只包含 4 个项目。这样就可使路由表大大简化。</p>
<p><a href="/pic/network/4-17.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-17.png" class="lazyload" title></a></p>
<p><strong>查找路由表</strong>：根据目的网络地址就能确定下一跳路由器，这样做的结果是：</p>
<ul>
<li>IP 数据报最终一定可以找到目的主机所在目的网络上的路由器（可能要通过多次的间接交付）。</li>
<li>只有到达最后一个路由器时，才试图向目的主机进行直接交付。</li>
</ul>
<p><strong>特定主机路由</strong>：这种路由是为特定的目的主机指明一个路由。采用特定主机路由可使网络管理人员能更方便地控制网络和测试网络，同时也可在需要考虑某种安全问题时采用这种特定主机路由。</p>
<p><strong>默认路由</strong>：路由器还可采用默认路由以减少路由表所占用的空间和搜索路由表所用的时间。这种转发方式在一个网络只有很少的对外连接时是很有用的。默认路由在主机发送 IP 数据报时往往更能显示出它的好处。如果一个主机连接在一个小网络上，而这个网络只用一个路由器和因特网连接，那么在这种情况下使用默认路由是非常合适的。</p>
<p><a href="/pic/network/4-18.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-18.png" class="lazyload" title></a></p>
<p>只要目的网络不是 N<sub>1</sub> 和 N<sub>2</sub>，就一律选择默认路由，把数据报先间接交付路由器 R<sub>1</sub>，让 R<sub>1</sub> 再转发给下一个路由器。</p>
<p>IP 数据报的首部中没有地方可以用来指明“下一跳路由器的 IP 地址”。当路由器收到待转发的数据报，不是将下一跳路由器的 IP 地址填入 IP 数据报，而是送交下层的网络接口软件。网络接口软件使用 ARP 负责将下一跳路由器的 IP 地址转换成硬件地址，并将此硬件地址放在链路层的 MAC 帧的首部，然后根据这个硬件地址找到下一跳路由器。</p>
<p><strong>分组转发算法</strong></p>
<ol>
<li>从数据报的首部提取目的主机的 IP 地址 <em>D</em>, 得出目的网络地址为 <em>N</em>。</li>
<li>若网络 <em>N</em> 与此路由器直接相连，则把数据报直接交付目的主机 <em>D</em>；否则是间接交付，执行3。</li>
<li>若路由表中有目的地址为 <em>D</em> 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行4。</li>
<li>若路由表中有到达网络 <em>N</em> 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行5。</li>
<li>若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行6。</li>
<li>报告转发分组出错。</li>
</ol>
<h2 id="3-划分子网和构造超网"><a class="markdownIt-Anchor" href="#3-划分子网和构造超网"></a> 3 划分子网和构造超网</h2>
<h3 id="31-划分子网"><a class="markdownIt-Anchor" href="#31-划分子网"></a> 3.1 划分子网</h3>
<p>在 ARPANET 的早期，IP 地址的设计确实不够合理。</p>
<ul>
<li>IP 地址空间的利用率有时很低。</li>
<li>给每一个物理网络分配一个网络号会使路由表变得太大因而使网络性能变坏。</li>
<li>两级的 IP 地址不够灵活。</li>
</ul>
<p>从 1985 年起在 IP 地址中又增加了一个“<strong>子网号字段</strong>”，使两级的 IP 地址变成为三级的 IP 地址。这种做法叫作<strong>划分子网</strong>(subnetting) 。划分子网已成为因特网的正式标准协议。</p>
<p><strong>划分子网的基本思路</strong></p>
<p>划分子网纯属一个单位内部的事情。单位对外仍然表现为没有划分子网的网络。从主机号借用若干个位作为子网号 subnet-id，而主机号 host-id 也就相应减少了若干个位。</p>
<pre class="highlight"><code class>IP地址 ::= {&lt;网络号&gt;, &lt;子网号&gt;, &lt;主机号&gt;}       
</code></pre>
<p>凡是从其他网络发送给本单位某个主机的 IP 数据报，仍然是根据 IP 数据报的目的网络号 net-id，先找到连接在本单位网络上的路由器。然后此路由器在收到 IP 数据报后，再按目的网络号 net-id 和子网号 subnet-id 找到目的子网。最后就将 IP 数据报直接交付目的主机。</p>
<p><a href="/pic/network/4-19.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-19.png" class="lazyload" title></a></p>
<p>划分子网后变成了三级结构：当没有划分子网时，IP 地址是两级结构。划分子网后 IP 地址就变成了三级结构。划分子网只是把 IP 地址的主机号 host-id 这部分进行再划分，而不改变 IP 地址原来的网络号 net-id。</p>
<p><strong>子网掩码</strong></p>
<p>从一个 IP 数据报的首部并无法判断源主机或目的主机所连接的网络是否进行了子网划分。使用子网掩码(subnet mask)可以找出 IP 地址中的子网部分。</p>
<p><a href="/pic/network/4-20.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-20.png" class="lazyload" title></a></p>
<p>子网掩码是一个网络或一个子网的重要属性。</p>
<ul>
<li>路由器在和相邻路由器交换路由信息时，必须把自己所在网络（或子网）的子网掩码告诉相邻路由器。</li>
<li>路由器的路由表中的每一个项目，除了要给出目的网络地址外，还必须同时给出该网络的子网掩码。</li>
<li>若一个路由器连接在两个子网上就拥有两个网络地址和两个子网掩码。</li>
</ul>
<h3 id="32-使用子网掩码的分组转发过程"><a class="markdownIt-Anchor" href="#32-使用子网掩码的分组转发过程"></a> 3.2 使用子网掩码的分组转发过程</h3>
<p>在不划分子网的两级 IP 地址下，从 IP 地址得出网络地址是个很简单的事。但在划分子网的情况下，从 IP 地址却不能唯一地得出网络地址来，这是因为网络地址取决于那个网络所采用的子网掩码，但数据报的首部并没有提供子网掩码的信息。因此分组转发的算法也必须做相应的改动。</p>
<p><strong>在划分子网的情况下路由器转发分组的算法</strong></p>
<ol>
<li>从收到的分组的首部提取目的 IP 地址 <em>D</em>。</li>
<li>先用各网络的子网掩码和 <em>D</em> 逐位相“与”，看是否和相应的网络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，执行(3)。</li>
<li>若路由表中有目的地址为 <em>D</em> 的<strong>特定主机路由</strong>，则将分组传送给指明的下一跳路由器；否则，执行(4)。</li>
<li>对路由表中的每一行的子网掩码和 <em>D</em> 逐位相“与”，若其结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行(5)。</li>
<li>若路由表中有一个<strong>默认路由</strong>，则将分组传送给路由表中所指明的默认路由器；否则，执行(6)。</li>
<li>报告转发分组出错。</li>
</ol>
<p><a href="/pic/network/4-21.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-21.png" class="lazyload" title></a></p>
<p>已知互联网和路由器 R1 中的路由表。主机 H1 向 H2 发送分组。试讨论 R1 收到 H1 向 H2 发送的分组后查找路由表的过程。</p>
<ol>
<li>主机 H1 要发送分组给 H2，要发送的分组的目的 IP 地址：128.30.33.138。因此 H1 首先检查主机 128.30.33.138 是否连接在本网络上如果是，则直接交付；否则，就送交路由器 R1，并逐项查找路由表。</li>
<li>主机 H1 首先将本子网的子网掩码 255.255.255.128 与分组的 IP 地址 128.30.33.138 逐比特相“与”(AND 操作) ，发现不等于 H1 的网络地址。</li>
<li>因此 H1 必须把分组传送到路由器 R1然后逐项查找路由表。路由器 R1 收到分组后就用路由表中第 1 个项目的<br>
子网掩码和 128.30.33.138 逐比特 AND 操作，结果与 128.30.33.0 不匹配。</li>
<li>路由器 R1 再用路由表中第 2 个项目的子网掩码和 128.30.33.138 逐比特 AND 操作，与 128.30.33.128 匹配，这表明子网 2 就是收到的分组所要寻找的目的网络。</li>
</ol>
<h3 id="33-无分类编址-cidr"><a class="markdownIt-Anchor" href="#33-无分类编址-cidr"></a> 3.3 无分类编址 CIDR</h3>
<p>划分子网在一定程度上缓解了因特网在发展中遇到的困难。然而在 1992 年因特网仍然面临三个必须尽早解决的问题，这就是：</p>
<ol>
<li>B 类地址在 1992 年已分配了近一半，眼看就要在 1994 年 3 月全部分配完毕！</li>
<li>因特网主干网上的路由表中的项目数急剧增长（从几千个增长到几万个）。</li>
<li>整个 IPv4 的地址空间最终将全部耗尽。</li>
</ol>
<p>无分类编址方法，它的正式名字是无分类域间路由选择 CIDR。</p>
<p>CIDR 消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念，因而可以更加有效地分配 IPv4 的地址空间。CIDR使用各种长度的“<strong>网络前缀</strong>”(network-prefix)来代替分类地址中的网络号和子网号。IP 地址从三级编址（使用子网掩码）又回到了两级编址。</p>
<p><strong>无分类的两级编址</strong></p>
<p>无分类的两级编址的记法是：</p>
<pre class="highlight"><code class>IP地址 ::= {&lt;网络前缀&gt;, &lt;主机号&gt;}           
</code></pre>
<p>CIDR 还使用“<strong>斜线记法</strong>”(slash notation)，它又称为CIDR记法，即在 IP 地址面加上一个斜线“/”，然后写上网络前缀所占的位数（这个数值对应于三级编址中子网掩码中 1 的个数）。</p>
<p>CIDR 把网络前缀都相同的连续的 IP 地址组成“<strong>CIDR 地址块</strong>”。</p>
<p><strong>CIDR 地址块</strong></p>
<p>128.14.32.0/20 表示的地址块共有 2<sup>12</sup> 个地址（因为斜线后面的 20 是网络前缀的位数，所以这个地址的主机号是 12 位）。这个地址块的起始地址是 128.14.32.0。在不需要指出地址块的起始地址时，也可将这样的地址块简称为“/20 地址块”。128.14.32.0/20 地址块的最小地址：128.14.32.0；最大地址：128.14.47.255。全 0 和全 1 的主机号地址一般不使用。</p>
<p><strong>路由聚合</strong></p>
<p>一个 CIDR 地址块可以表示很多地址，这种地址的聚合常称为<strong>路由聚合</strong>，它使得路由表中的一个项目可以表示很多个（例如上千个）原来传统分类地址的路由。路由聚合也称为<strong>构成超网</strong>(supernetting)。</p>
<p>CIDR 虽然不使用子网了，但仍然使用“<strong>掩码</strong>”这一名词（但不叫子网掩码）。对于 /20 地址块，它的掩码是 20 个连续的 1。 斜线记法中的数字就是掩码中1的个数。</p>
<p><strong>CIDR 记法的其他形式</strong></p>
<p>10.0.0.0/10 可简写为 10/10，也就是将点分十进制中低位连续的 0 省略。</p>
<p>10.0.0.0/10 相当于指出 IP 地址 10.0.0.0 的掩码是 255.192.0.0，即11111111 11000000 00000000 00000000</p>
<p>网络前缀的后面加一个星号 * 的表示方法，如 00001010 00*，在星号 * 之前是网络前缀，而星号 * 表示 IP 地址中的主机号，可以是任意值。</p>
<p><strong>构成超网</strong></p>
<p>前缀长度不超过 23 位的 CIDR 地址块都包含了多个 C 类地址。这些 C 类地址合起来就构成了<strong>超网</strong>。</p>
<p>CIDR 地址块中的地址数一定是 2 的整数次幂。网络前缀越短，其地址块所包含的地址数就越多。而在三级结构的IP地址中，划分子网是使网络前缀变长。</p>
<p><a href="/pic/network/4-22.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-22.png" class="lazyload" title></a></p>
<p><strong>最长前缀匹配</strong></p>
<p>使用 CIDR 时，路由表中的每个项目由“<strong>网络前缀</strong>”和“<strong>下一跳地址</strong>”组成。在查找路由表时可能会得到不止一个匹配结果。 应当从匹配结果中选择具有最长网络前缀的路由：<strong>最长前缀匹配</strong>。网络前缀越长，其地址块就越小，因而路由就越具体。最长前缀匹配又称为最长匹配或最佳匹配。</p>
<p><strong>使用二叉线索查找路由表</strong></p>
<p>当路由表的项目数很大时，怎样设法减小路由表的查找时间就成为一个非常重要的问题。 为了进行更加有效的查找，通常是将无分类编址的路由表存放在一种层次的数据结构中，然后自上而下地按层次进行查找。这里最常用的就是<strong>二叉线索</strong>(binary trie)。</p>
<p>IP 地址中从左到右的比特值决定了从根结点逐层向下层延伸的路径，而二叉线索中的各个路径就代表路由表中存放的各个地址。为了提高二叉线索的查找速度，广泛使用了各种压缩技术。</p>
<p><a href="/pic/network/4-23.png" data-fancybox="group" data-caption class="fancybox"><img alt data-src="/pic/network/4-23.png" class="lazyload" title></a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">fc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://fengce1993.github.io/2020/02/02/network-4-1/">http://fengce1993.github.io/2020/02/02/network-4-1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://fengce1993.github.io">BLEACH</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/02/03/network-4-2/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>计算机网络(五)：网络层(二)</span></div></a></div><div class="next-post pull_right"><a href="/2020/01/30/network-3/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>计算机网络(三)：数据链路层</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/01/21/network-1/" title="计算机网络(一)：计算机网络概述"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-21</div><div class="relatedPosts_title">计算机网络(一)：计算机网络概述</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/28/network-2/" title="计算机网络(二)：物理层"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-28</div><div class="relatedPosts_title">计算机网络(二)：物理层</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/05/network-5/" title="计算机网络(六)：运输层"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-05</div><div class="relatedPosts_title">计算机网络(六)：运输层</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/06/network-6/" title="计算机网络(气)：应用层"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-06</div><div class="relatedPosts_title">计算机网络(气)：应用层</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/30/network-3/" title="计算机网络(三)：数据链路层"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-30</div><div class="relatedPosts_title">计算机网络(三)：数据链路层</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/03/network-4-2/" title="计算机网络(五)：网络层(二)"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-03</div><div class="relatedPosts_title">计算机网络(五)：网络层(二)</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '98c8aa074b828fc6bd11',
  clientSecret: 'e0e862ca02f30148e7b5f049bd5a736d7831a717',
  repo: 'fengce1993.github.io',
  owner: 'fengce1993',
  admin: 'fengce1993',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
}</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By fc</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>